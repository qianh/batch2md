# UV Migration Summary

**Date**: 2025-11-05  
**Status**: ✅ Complete

## Overview

Successfully migrated `batch2md` from pip/setuptools to **uv** for modern, fast Python package management.

## What Changed

### New Files Created

1. **pyproject.toml** - Modern Python project configuration
   - Replaces setup.py as primary configuration
   - Includes all dependencies, dev dependencies, and tools config
   - Compatible with PEP 517/518 standards

2. **.python-version** - Python version specification (3.10)
   - Used by uv to select correct Python version
   - Simple text file: `3.10`

3. **uv.lock** - Dependency lock file (355 KB)
   - Pin all transitive dependencies
   - Ensures reproducible builds across environments
   - Auto-generated by `uv sync`

4. **.gitignore** - Standard Python/uv ignore patterns
   - Ignores `.venv/`, `__pycache__/`, build artifacts
   - Prevents committing generated files

### Files Updated

1. **README.md**
   - Added uv installation instructions
   - Updated Python requirement: 3.8+ → 3.10+
   - Added "Why uv?" section

2. **CLAUDE.md**
   - Updated all commands to use `uv run`
   - Added environment management section
   - Updated Python version requirement

3. **pyproject.toml** (consolidated config)
   - Moved pytest config from pytest.ini
   - Added black, mypy, coverage configurations
   - All tool configs in one place

### Files Kept (Backward Compatibility)

- **setup.py** - For users who prefer pip
- **requirements.txt** - Simple dependency list
- **requirements-dev.txt** - Dev dependencies

## Python Version Update

**Changed**: `requires-python = ">=3.8"` → `">=3.10,<3.14"`

**Reason**: MinerU requires Python 3.10+. The original 3.8 requirement was incorrect.

## Commands Migration

| Task | Old (pip) | New (uv) |
|------|-----------|----------|
| Install | `pip install -e .` | `uv sync` |
| Install dev | `pip install -e ".[dev]"` | `uv sync --extra dev` |
| Run tests | `pytest tests/` | `uv run pytest tests/` |
| Run tool | `batch2md /path` | `uv run batch2md /path` |
| Format | `black src/` | `uv run black src/` |
| Add dependency | `pip install <pkg>` | `uv add <pkg>` |

## Testing Results

✅ **All tests pass with uv**

```
uv run pytest tests/ -v
```

Results:
- 69 passed
- 17 skipped (expected - missing test fixtures)
- 0 failed
- Execution time: ~87 seconds

## Benefits of UV

1. **Speed**: 10-100x faster than pip
   - Installed 94 packages in 30 seconds
   - pip would take 5-10 minutes

2. **Reliability**: Lock file ensures reproducibility
   - uv.lock pins all transitive dependencies
   - Same versions across all environments

3. **Simplicity**: Single tool for everything
   - Package management
   - Virtual environment management
   - Python version management

4. **Compatibility**: Drop-in pip replacement
   - Reads pyproject.toml, setup.py, requirements.txt
   - Works with existing Python ecosystem

## Developer Workflow

### First Time Setup

```bash
git clone <repo>
cd batch2md
uv sync --extra dev
```

That's it! No need to create virtualenv, no need to activate it.

### Daily Development

```bash
# Run tests
uv run pytest tests/

# Run tool
uv run batch2md /path/to/docs --verbose

# Format code
uv run black src/ tests/

# Type check
uv run mypy src/
```

### Adding Dependencies

```bash
# Runtime dependency
uv add requests

# Dev dependency
uv add --dev pytest-mock

# Sync after manual edits to pyproject.toml
uv sync
```

## Rollback Plan (if needed)

If you need to use pip instead:

```bash
# Remove uv virtual environment
rm -rf .venv

# Use traditional pip workflow
python3.10 -m venv venv
source venv/bin/activate
pip install -e ".[dev]"
```

All pip commands still work because setup.py and requirements.txt are maintained.

## Future Considerations

### Optional: Remove Legacy Files

Once all users migrate to uv, consider removing:
- setup.py
- requirements.txt
- requirements-dev.txt
- pytest.ini (moved to pyproject.toml)

These are kept now for backward compatibility.

### UV Features Not Yet Used

- `uv python install` - Install specific Python versions
- `uv tool install` - Install CLI tools globally
- `uv run --isolated` - Run with isolated dependencies

## References

- UV Documentation: https://github.com/astral-sh/uv
- pyproject.toml spec: https://peps.python.org/pep-0621/
- Migration guide: https://docs.astral.sh/uv/guides/projects/
